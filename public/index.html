<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>BAC Playground CTF</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #0f0; padding: 20px; }
        .panel { border: 1px solid #0f0; padding: 15px; margin-bottom: 10px; }
        button { background: #0f0; color: #000; border: none; padding: 5px 10px; cursor: pointer; font-weight: bold; }
        input { background: #333; color: #fff; border: 1px solid #555; }
        .hidden { display: none; }
        h2 { border-bottom: 1px dashed #0f0; }
        #console { background: #000; border: 1px solid #555; height: 150px; overflow-y: scroll; padding: 10px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>System Kontroli Dostępu v1.0 (Vulnerable)</h1>
    <p>Zalogowany jako: <span id="userStatus">Gość</span></p>

    <div class="panel">
        <h2>1. Admin Panel</h2>
        <p>Dostęp tylko dla administratorów.</p>
        <button onclick="checkAdmin()">Wejdź do panelu</button>
    </div>

    <div class="panel">
        <h2>2. Podgląd Profilu (IDOR)</h2>
        <label>Twoje ID: 2. Podgląd ID:</label>
        <input type="number" id="profileId" value="2">
        <button onclick="viewProfile()">Zobacz</button>
    </div>

    <div class="panel">
        <h2>3. Usuwanie Raportów</h2>
        <p>Tylko admin może usuwać raporty (wymaga POST).</p>
        <button onclick="deleteReport()">Usuń Raport</button>
    </div>
    
    <div class="panel">
        <h2>5. Aktualizacja Profilu</h2>
        <p>Zaktualizuj swoje bio.</p>
        <input type="text" id="bioInput" placeholder="Nowe bio...">
        <button onclick="updateProfile()">Zapisz</button>
    </div>

    <div class="panel" style="display:none;" id="adminControls">
        <h2>7. Emergency Stop</h2>
        <button onclick="emergencyStop()">STOP SYSTEM</button>
    </div>

    <div id="console">Logi systemowe...</div>

    <script>
        function log(msg) {
            const c = document.getElementById('console');
            c.innerHTML += `<div>> ${JSON.stringify(msg)}</div>`;
            c.scrollTop = c.scrollHeight;
        }

        async function checkAdmin() {
            const res = await fetch('/api/admin-panel');
            log(await res.json());
        }

        async function viewProfile() {
            const id = document.getElementById('profileId').value;
            const res = await fetch(`/api/profile?id=${id}`);
            log(await res.json());
        }

        async function deleteReport() {
            // Frontend wysyła POST, ale serwer ma lukę na GET...
            const res = await fetch('/api/delete-report', { method: 'POST' });
            log(await res.json());
        }

        async function updateProfile() {
            const bio = document.getElementById('bioInput').value;
            // Normalne żądanie
            const res = await fetch('/api/update-user', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ bio: bio })
            });
            log(await res.json());
        }
        
        async function emergencyStop() {
            const res = await fetch('/api/emergency-stop', { method: 'POST' });
            log(await res.json());
        }
    </script>
</body>
</html>